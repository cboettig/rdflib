<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Working with Database Storage Backends in <code>rdflib</code> • rdflib</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="Working with Database Storage Backends in &lt;code&gt;rdflib&lt;/code&gt;">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">rdflib</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.1.1.9999</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/articles/data-lake.html">The Data Lake and Schema On Read</a>
    </li>
    <li>
      <a href="../../articles/articles/storage.html">Working with Database Storage Backends in `rdflib`</a>
    </li>
    <li>
      <a href="../../articles/rdf_intro.html">A tidyverse lover's intro to RDF</a>
    </li>
    <li>
      <a href="../../articles/slides/slides.html">RDF for Tidyverse Lovers</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ropensci/rdflib">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Working with Database Storage Backends in <code>rdflib</code>
</h1>
                        <h4 class="author">Carl Boettiger</h4>
            
            <h4 class="date">2018-11-01</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/rdflib/blob/master/vignettes/articles/storage.Rmd"><code>vignettes/articles/storage.Rmd</code></a></small>
      <div class="hidden name"><code>storage.Rmd</code></div>

    </div>

    
    
<p>By default, <code>rdflib</code> stores triples in memory, which can be read in from and written out to files on disk using a variety of serializations (<code>rdfxml</code>, <code>json-ld</code>, <code>ntriples</code>, <code>nquads</code> or <code>turtle</code>). This is analgous to reading in a <code>data.frame</code> object from a <code>csv</code>, <code>tsv</code>, or other text-delimited file, which requires the full data object to be read into memory before a user can manipulate it. This approach runs into limitations with very large datasets, which may exceed the memory available. Just as R packages such as <code>dplyr</code> offer the ability to perform manipulations with very large data through a connection to a database backend such as SQLite, MySQL or PostgreSQL, <code>rdflib</code> can rely on these and other databases to provide a disk-based backend.</p>
<div id="installation" class="section level3">
<h3 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h3>
<p>Unfortunately, at this time, support for these storage devices is not included in the prebuild Mac and Windows binaries of the <code>redland</code> R package. Users wanting to take advantage of disk-based storage must instead build and install the <code>redland</code> R package from source; and in some cases, also build the <code>redland</code> C libraries from source. This package provides a <a href="https://github.com/ropensci/rdflib/blob/master/inst/docker/Dockerfile">Dockerfile</a> containing a portable recipe for building the library with support for the 5 main backend storage devices: SQLite, MySQL, PostgreSQL, Virtuoso, and Berkeley DB. This vignette documents the installation and use of these devices.</p>
<p>Also see the <a href="http://librdf.org/docs/api/redland-storage-modules.html">official documentation</a> for the redland C library discussing all supported storage devices.</p>
</div>
<div id="benchmarks" class="section level1">
<h1 class="hasAnchor">
<a href="#benchmarks" class="anchor"></a>Benchmarks</h1>
<p>Here we show examples of reading in a modest set of 190,000 triples from an <code>nquads</code> file and executing a simple SPARQL query using each the five backends supported by <code>rdflib</code>. First we load the libraries and prepare an example file by triple-ifying 10,000 rows of the <code>flights</code> data.frame:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rdflib)
<span class="kw">library</span>(nycflights13)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">example &lt;-<span class="st"> </span>flights[<span class="dv">1</span><span class="op">:</span><span class="fl">1e4</span>,] <span class="co"># a subset for testing</span>
<span class="kw"><a href="../../reference/write_nquads.html">write_nquads</a></span>(example, <span class="st">"flights.nq"</span>, <span class="dt">prefix =</span> <span class="st">"flights"</span>)</code></pre></div>
<div id="in-memory" class="section level2">
<h2 class="hasAnchor">
<a href="#in-memory" class="anchor"></a>In Memory</h2>
<p>Because the dataset is small enough to easily fit in memory, the default in-memory option is an obvious choice with excellent performance. Note that this option will not be possible with larger triplestores (e.g. with millions or more triples). Our testing has found that even on machines with 100GB+ of RAM, the redland in-memory backend is not able to take advantage of that additional memory and disk-based backends are required.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">triplestore &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/rdf.html">rdf</a></span>()
<span class="kw">system.time</span>(
  <span class="kw"><a href="../../reference/read_nquads.html">read_nquads</a></span>(<span class="st">"flights.nq"</span>, <span class="dt">rdf =</span> triplestore)
)
<span class="co">#&gt;    user  system elapsed </span>
<span class="co">#&gt;   1.156   0.028   1.188</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">query &lt;-<span class="st"> </span>
<span class="st">  'SELECT  ?carrier ?flight ?origin ?dep_delay</span>
<span class="st">WHERE {</span>
<span class="st">?flight &lt;x:carrier&gt;  ?carrier .</span>
<span class="st">?flight &lt;x:dep_delay&gt;  ?dep_delay .</span>
<span class="st">?flight &lt;x:origin&gt; ?origin</span>
<span class="st">}'</span>

<span class="kw">system.time</span>(
df &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/rdf_query.html">rdf_query</a></span>(triplestore, query)
)
<span class="co">#&gt;    user  system elapsed </span>
<span class="co">#&gt;   0.496   0.012   0.510</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../../reference/rdf_free.html">rdf_free</a></span>(triplestore)</code></pre></div>
</div>
<div id="bdb" class="section level2">
<h2 class="hasAnchor">
<a href="#bdb" class="anchor"></a>BDB</h2>
<p>The <a href="https://en.wikipedia.org/wiki/Berkeley_DB">Berkeley DB</a> is a simple key-value store</p>
<blockquote>
<p>It is the most mature and primary persistent store and suitable for large models, tested in the 2-3 million range.</p>
</blockquote>
<p>Berkeley DB is a simple disk-based storage option. Install both the redland libraries and the berkeley-db (e.g. <code>bd-dev</code> on Debian/Ubuntu) libraries, and then install <code>redland</code> from source. BDB is relatively fast for data too large for memory.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">triplestore &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/rdf.html">rdf</a></span>(<span class="dt">storage=</span><span class="st">"BDB"</span>, <span class="dt">new_db =</span> <span class="ot">TRUE</span>)
<span class="kw">system.time</span>(
  <span class="kw"><a href="../../reference/read_nquads.html">read_nquads</a></span>(<span class="st">"flights.nq"</span>, <span class="dt">rdf =</span> triplestore)
)
<span class="co">#&gt;    user  system elapsed </span>
<span class="co">#&gt;   2.336   0.484   2.820</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">system.time</span>(
df &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/rdf_query.html">rdf_query</a></span>(triplestore, query)
)
<span class="co">#&gt;    user  system elapsed </span>
<span class="co">#&gt;   0.548   0.008   0.558</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../../reference/rdf_free.html">rdf_free</a></span>(triplestore)
## Becuase BDB is just a hash table, redland needs three separate files:
<span class="kw">unlink</span>(<span class="st">"rdflib-po2s.db"</span>)
<span class="kw">unlink</span>(<span class="st">"rdflib-so2p.db"</span>)
<span class="kw">unlink</span>(<span class="st">"rdflib-sp2o.db"</span>)</code></pre></div>
</div>
<div id="virtuoso" class="section level2">
<h2 class="hasAnchor">
<a href="#virtuoso" class="anchor"></a>Virtuoso</h2>
<p>Unlike the other backends which use general purpose relational databases or key-value stores, <a href="https://en.wikipedia.org/wiki/Virtuoso_Universal_Server">Virtuoso</a> dedicated to RDF-based data. Virtuoso is a popular open source database for RDF with a rich set of built-in interfaces and features, but we can also interact with it directly through the <code>redland</code> bindings just like we do any other backend in <code>rdflib</code>. Virtuoso setup may be slightly more involved for individuals unfamiliar with it, but will probably provide the best performance in the case of very large triplestores. The example below shows a new database setup, but <code>rdflib</code> can also connect to any existing Virtuoso database.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">triplestore &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/rdf.html">rdf</a></span>(<span class="dt">storage =</span> <span class="st">"virtuoso"</span>, 
                   <span class="dt">user =</span> <span class="st">"dba"</span>, 
                   <span class="dt">password =</span> <span class="st">"dba"</span>, 
                   <span class="dt">dsn =</span> <span class="st">"Local Virtuoso"</span>
                   )

<span class="kw">system.time</span>(
  <span class="kw"><a href="../../reference/read_nquads.html">read_nquads</a></span>(<span class="st">"flights.nq"</span>, <span class="dt">rdf =</span> triplestore)
)
<span class="co">#&gt;    user  system elapsed </span>
<span class="co">#&gt;   7.432   6.648 239.139</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">system.time</span>(
df &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/rdf_query.html">rdf_query</a></span>(triplestore, query)
)
<span class="co">#&gt;    user  system elapsed </span>
<span class="co">#&gt;  50.868  32.964 455.013</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../../reference/rdf_free.html">rdf_free</a></span>(triplestore)</code></pre></div>
</div>
<div id="postgres" class="section level2">
<h2 class="hasAnchor">
<a href="#postgres" class="anchor"></a>POSTGRES</h2>
<p>Postgres and MySQL are ubiquitious relational databases.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">triplestore &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/rdf.html">rdf</a></span>(<span class="dt">storage =</span> <span class="st">"postgres"</span>, 
                   <span class="dt">host =</span> <span class="st">"postgres"</span>, 
                   <span class="dt">user =</span> <span class="st">"postgres"</span>, 
                   <span class="dt">password =</span> <span class="st">"rdflib"</span>, 
                   <span class="dt">new_db =</span> <span class="ot">TRUE</span>)
<span class="kw">system.time</span>(
  <span class="kw"><a href="../../reference/read_nquads.html">read_nquads</a></span>(<span class="st">"flights.nq"</span>, <span class="dt">rdf =</span> triplestore)
)
<span class="co">#&gt;     user   system  elapsed </span>
<span class="co">#&gt;   29.472   61.588 2823.625</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">system.time</span>(
df &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/rdf_query.html">rdf_query</a></span>(triplestore, query)
)
<span class="co">#&gt;    user  system elapsed </span>
<span class="co">#&gt;   0.004   0.000   0.216</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../../reference/rdf_free.html">rdf_free</a></span>(triplestore)</code></pre></div>
</div>
<div id="mysql" class="section level2">
<h2 class="hasAnchor">
<a href="#mysql" class="anchor"></a>MySQL</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">triplestore &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/rdf.html">rdf</a></span>(<span class="dt">storage =</span> <span class="st">"mysql"</span>, 
                   <span class="dt">host =</span> <span class="st">"mariadb"</span>, 
                   <span class="dt">user =</span> <span class="st">"root"</span>, 
                   <span class="dt">password =</span> <span class="st">"rdflib"</span>, 
                   <span class="dt">database =</span> <span class="st">"mysql"</span>,
                   <span class="dt">new_db =</span> <span class="ot">TRUE</span>
                  )
<span class="kw">system.time</span>(
  <span class="kw"><a href="../../reference/read_nquads.html">read_nquads</a></span>(<span class="st">"flights.nq"</span>, <span class="dt">rdf =</span> triplestore)
)
<span class="co">#&gt;    user  system elapsed </span>
<span class="co">#&gt;  10.992  26.544 159.376</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">system.time</span>(
df &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/rdf_query.html">rdf_query</a></span>(triplestore, query)
)
<span class="co">#&gt;    user  system elapsed </span>
<span class="co">#&gt;   0.000   0.000   2.055</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../../reference/rdf_free.html">rdf_free</a></span>(triplestore)</code></pre></div>
</div>
<div id="sqlite" class="section level2">
<h2 class="hasAnchor">
<a href="#sqlite" class="anchor"></a>SQLite</h2>
<p><a href="https://en.wikipedia.org/wiki/SQLite">SQLite</a> is relatively easy to set up, but appears to have rather poor overall performance.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">triplestore &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/rdf.html">rdf</a></span>(<span class="dt">storage=</span><span class="st">"sqlite"</span>, <span class="dt">new_db =</span> <span class="ot">TRUE</span>, <span class="dt">name=</span><span class="st">"rdflib.sqlite"</span>)

<span class="kw">system.time</span>(
  <span class="kw"><a href="../../reference/read_nquads.html">read_nquads</a></span>(<span class="st">"flights.nq"</span>, <span class="dt">rdf =</span> triplestore)
)
<span class="co">#&gt;    user  system elapsed </span>
<span class="co">#&gt; 204.236  59.024 842.972</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">system.time</span>(
df &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/rdf_query.html">rdf_query</a></span>(triplestore, query)
)
<span class="co">#&gt;    user  system elapsed </span>
<span class="co">#&gt;   0.028   0.000   0.030</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../../reference/rdf_free.html">rdf_free</a></span>(triplestore)</code></pre></div>
</div>
</div>
<div id="testing" class="section level1">
<h1 class="hasAnchor">
<a href="#testing" class="anchor"></a>Testing</h1>
<p><code>rdflib</code> uses Circle-CI to test database backends using <code>docker-compose</code>. <code>docker-compose</code> pulls down dedicated docker containers for <code>postgres</code> and <code>mariadb</code>, along with the <code>ropensci/rdflib</code> container, which includes a version of <code>redland</code> compiled with support for all five major backend storage systems. At this time, testing is configured for:</p>
<ul>
<li>Berkeley DB</li>
<li>SQLite</li>
<li>Postgres</li>
<li>MySQL (Using MariaDB)</li>
<li>Virtuoso</li>
</ul>
<p>The badge below (also on the package README) indicates that these dedicated tests are passing.</p>
<p><a href="https://circleci.com/gh/ropensci/rdflib"><img src="https://circleci.com/gh/ropensci/rdflib.svg?style=svg" alt="CircleCI"></a></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#benchmarks">Benchmarks</a><ul class="nav nav-pills nav-stacked">
<li><a href="#in-memory">In Memory</a></li>
      <li><a href="#bdb">BDB</a></li>
      <li><a href="#virtuoso">Virtuoso</a></li>
      <li><a href="#postgres">POSTGRES</a></li>
      <li><a href="#mysql">MySQL</a></li>
      <li><a href="#sqlite">SQLite</a></li>
      </ul>
</li>
      <li><a href="#testing">Testing</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Carl Boettiger.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
